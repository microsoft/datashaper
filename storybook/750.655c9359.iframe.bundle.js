/*! For license information please see 750.655c9359.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk_datashaper_stories=self.webpackChunk_datashaper_stories||[]).push([[750],{"../../.yarn/__virtual__/@datashaper-tables-virtual-cb2f1a5962/1/javascript/tables/src/applyCodebook.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{K:()=>applyCodebook});var _datashaper_schema__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../schema/src/workflow/verbs.ts"),arquero__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../.yarn/cache/arquero-npm-5.4.0-7652cf4e19-b2cb2e2d9e.zip/node_modules/arquero/src/index.js"),_parseTypes_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../.yarn/__virtual__/@datashaper-tables-virtual-cb2f1a5962/1/javascript/tables/src/parseTypes.ts");function applyCodebook(table,codebook,strategy,dataTableSchema){const exclude=codebook.fields.filter((f=>f.exclude)).map((f=>f.name));let applied=table.select((0,arquero__WEBPACK_IMPORTED_MODULE_0__.ff)(exclude));if(strategy===_datashaper_schema__WEBPACK_IMPORTED_MODULE_1__.ZN.DataTypeOnly||strategy===_datashaper_schema__WEBPACK_IMPORTED_MODULE_1__.ZN.DataTypeAndMapping){const args=codebook.fields.reduce(((acc,cur)=>{if(!cur.exclude){const parser=null!=dataTableSchema?.typeHints?(0,_parseTypes_js__WEBPACK_IMPORTED_MODULE_2__.BY)(cur.type,cur.subtype,dataTableSchema.typeHints):(0,_parseTypes_js__WEBPACK_IMPORTED_MODULE_2__.BY)(cur.type,cur.subtype);acc[cur.name]=(0,arquero__WEBPACK_IMPORTED_MODULE_0__.YU)((d=>parser(d[cur.name])))}return acc}),{});applied=applied.derive(args)}if(strategy===_datashaper_schema__WEBPACK_IMPORTED_MODULE_1__.ZN.MappingOnly||strategy===_datashaper_schema__WEBPACK_IMPORTED_MODULE_1__.ZN.DataTypeAndMapping){const args2=codebook.fields.filter((element=>null!=element.mapping)).reduce(((acc,cur)=>(acc[cur.name]=(0,arquero__WEBPACK_IMPORTED_MODULE_0__.YU)((d=>arquero__WEBPACK_IMPORTED_MODULE_0__.op.recode(d[cur.name],cur.mapping?cur.mapping:{}))),acc)),{});return applied.derive(args2)}return applied}},"../../.yarn/__virtual__/@datashaper-tables-virtual-cb2f1a5962/1/javascript/tables/src/binning.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>fixedBinCount,z:()=>fixedBinStep});var arquero__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../.yarn/cache/arquero-npm-5.4.0-7652cf4e19-b2cb2e2d9e.zip/node_modules/arquero/src/index.js");function fixedBinCount(column,min,max,count,clamped=!1,format=!1){return fixedBinStep(column,min,max,(max-min)/count,clamped,format)}function fixedBinStep(column,min=0,max=0,step=0,clamped=!1,format=!1){const binFn=function bin(min,max,step,clamped){const count=Math.floor((max-min)/step),ultimate=min+step*count,penultimate=min+step*(count-1),adjust_bin_max=ultimate>=max;return function(value){const candidate=arquero__WEBPACK_IMPORTED_MODULE_0__.op.bin(value,min,max,step);if(clamped){if(candidate===-1/0)return min;if(candidate===1/0)return adjust_bin_max?penultimate:ultimate}return candidate===-1/0||candidate===1/0?candidate:candidate>=max?penultimate:candidate}}(min,max,step,clamped);return(0,arquero__WEBPACK_IMPORTED_MODULE_0__.YU)((d=>{const value=binFn(d[column]);if(format){if(value<min)return`<${min}`;if(value>max)return`>${max}`;const top=value+step;return value>=max-step?`${value} to ${top>max?max:top}`:`${value} to <${top}`}return value}))}},"../../.yarn/__virtual__/@datashaper-tables-virtual-cb2f1a5962/1/javascript/tables/src/container.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function container(id,table,metadata){return{id,table,metadata}}__webpack_require__.d(__webpack_exports__,{n:()=>container})},"../../.yarn/__virtual__/@datashaper-tables-virtual-cb2f1a5962/1/javascript/tables/src/data.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ce:()=>formatIfNumber,oQ:()=>coerce,wj:()=>determineType});var _datashaper_schema__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../schema/src/data.ts"),lodash_es_isArray_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../.yarn/cache/lodash-es-npm-4.17.21-b45832dfce-03f39878ea.zip/node_modules/lodash-es/isArray.js"),lodash_es_isDate_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../.yarn/cache/lodash-es-npm-4.17.21-b45832dfce-03f39878ea.zip/node_modules/lodash-es/isDate.js"),lodash_es_isNaN_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../.yarn/cache/lodash-es-npm-4.17.21-b45832dfce-03f39878ea.zip/node_modules/lodash-es/isNaN.js"),lodash_es_isNil_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../.yarn/cache/lodash-es-npm-4.17.21-b45832dfce-03f39878ea.zip/node_modules/lodash-es/isNil.js");function determineType(value){if((0,lodash_es_isNil_js__WEBPACK_IMPORTED_MODULE_0__.Z)(value))return _datashaper_schema__WEBPACK_IMPORTED_MODULE_1__.g.Unknown;if((0,lodash_es_isNaN_js__WEBPACK_IMPORTED_MODULE_2__.Z)(value))return _datashaper_schema__WEBPACK_IMPORTED_MODULE_1__.g.Number;const type=typeof value;if("object"===type){if((0,lodash_es_isDate_js__WEBPACK_IMPORTED_MODULE_3__.Z)(value))return _datashaper_schema__WEBPACK_IMPORTED_MODULE_1__.g.Date;if((0,lodash_es_isArray_js__WEBPACK_IMPORTED_MODULE_4__.Z)(value))return _datashaper_schema__WEBPACK_IMPORTED_MODULE_1__.g.Array}return type}function coerce(value,dataType){switch(dataType){case _datashaper_schema__WEBPACK_IMPORTED_MODULE_1__.g.Number:return Number.parseFloat(value);case _datashaper_schema__WEBPACK_IMPORTED_MODULE_1__.g.Date:return new Date(value);case _datashaper_schema__WEBPACK_IMPORTED_MODULE_1__.g.Boolean:return!!value;default:return value}}function format(value,options){if(0===value)return"0";const{minExp=5,precision=2}=options||{},getExp=(value,exp=0)=>value%10==0?getExp(value/10,exp+1):exp;let exp,mantissa;if(Number.isInteger(value)){if(exp=getExp(value),!Number.isInteger(exp)||0===exp||exp<=minExp)return`${value}`}else if(exp=Math.floor(Math.log10(value)),mantissa=value/Math.pow(10,exp),Math.abs(exp)<=minExp||!Number.isInteger(mantissa)){const fixed=value.toFixed(precision);return`${Number.parseFloat(fixed)}`}return mantissa=value/Math.pow(10,exp),`${mantissa}e${exp}`}function formatIfNumber(value){if("number"==typeof value)return format(value);if("string"==typeof value){const parsed=Number.parseFloat(value);if(Number.isFinite(parsed))return format(parsed)}return value}},"../../.yarn/__virtual__/@datashaper-workflow-virtual-9a99b417c8/1/javascript/workflow/src/dataflow/types.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{var NodeInput,NodeOutput;__webpack_require__.d(__webpack_exports__,{o:()=>NodeInput,u:()=>NodeOutput}),function(NodeInput){NodeInput.Source="source",NodeInput.Other="other",NodeInput.Others="others"}(NodeInput||(NodeInput={})),function(NodeOutput){NodeOutput.Result="result",NodeOutput.Remainder="remainder"}(NodeOutput||(NodeOutput={}))},"../../.yarn/__virtual__/@datashaper-workflow-virtual-9a99b417c8/1/javascript/workflow/src/predicates.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{NT:()=>isTableEmitter,hM:()=>dereference});var _datashaper_schema__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../schema/src/enums/Profile.ts");const dereference=r=>(r=>r?.isReference?.()??!1)(r)?r.target:r,isTableEmitter=r=>r?.profile===_datashaper_schema__WEBPACK_IMPORTED_MODULE_0__.w.TableBundle||r?.profile===_datashaper_schema__WEBPACK_IMPORTED_MODULE_0__.w.DataTable},"../../.yarn/__virtual__/@datashaper-workflow-virtual-9a99b417c8/1/javascript/workflow/src/resources/Disposable.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{J:()=>Disposable});var rxjs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../.yarn/cache/rxjs-npm-7.8.1-41c443a75b-b10cac1a52.zip/node_modules/rxjs/dist/esm5/internal/Subject.js");class Disposable{onDispose(handler){const handlerFn="function"==typeof handler?handler:()=>handler.unsubscribe(),sub=this._onDispose.subscribe(handlerFn);return()=>sub.unsubscribe()}dispose(){this._onDispose.next(),this._onDispose.complete()}constructor(){!function _define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}(this,"_onDispose",new rxjs__WEBPACK_IMPORTED_MODULE_0__.x)}}},"../../.yarn/__virtual__/@datashaper-workflow-virtual-9a99b417c8/1/javascript/workflow/src/resources/Observed.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{b:()=>Observed});var rxjs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../.yarn/cache/rxjs-npm-7.8.1-41c443a75b-b10cac1a52.zip/node_modules/rxjs/dist/esm5/internal/Subject.js"),_Disposable_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../.yarn/__virtual__/@datashaper-workflow-virtual-9a99b417c8/1/javascript/workflow/src/resources/Disposable.ts");class Observed extends _Disposable_js__WEBPACK_IMPORTED_MODULE_0__.J{onChange(handler,fireSync){const sub=this._onChange.subscribe(handler);return fireSync&&handler(),()=>sub.unsubscribe()}dispose(){this._onChange.complete(),super.dispose()}constructor(...args){super(...args),function _define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}(this,"_onChange",new rxjs__WEBPACK_IMPORTED_MODULE_1__.x)}}},"../../.yarn/__virtual__/@datashaper-workflow-virtual-9a99b417c8/1/javascript/workflow/src/resources/Resource.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_:()=>Resource});var predicates=__webpack_require__("../../.yarn/__virtual__/@datashaper-workflow-virtual-9a99b417c8/1/javascript/workflow/src/predicates.ts"),Observed=__webpack_require__("../../.yarn/__virtual__/@datashaper-workflow-virtual-9a99b417c8/1/javascript/workflow/src/resources/Observed.ts");function _define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class Named extends Observed.b{defaultTitle(){}defaultName(){return"resource"}get name(){return this._name}set name(value){this._name=value,this._onChange.next()}get title(){return this._title}set title(value){this._title=value,this._onChange.next()}get description(){return this._description}set description(value){this._description=value,this._onChange.next()}toSchema(){return{name:this.name,title:this.title,description:this.description}}loadSchema(schema,quiet=!1){this._name=schema?.name??this.defaultName(),this._title=schema?.title??this.defaultTitle(),this._description=schema?.description,quiet||this._onChange.next()}constructor(...args){super(...args),_define_property(this,"_name",this.defaultName()),_define_property(this,"_title",this.defaultTitle()),_define_property(this,"_description",void 0)}}function Resource_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class Resource extends Named{defaultName(){return this.profile??"resource"}get dataPackage(){return this._dataPackage}set dataPackage(value){this._dataPackage=value}isReference(){return!1}get path(){return this._path}set path(value){this._path=value,this._onChange.next()}get rel(){return this._rel}set rel(value){this._rel=value,this._onChange.next()}get homepage(){return this._homepage}set homepage(value){this._homepage=value,this._onChange.next()}get license(){return this._license}set license(value){this._license=value,this._onChange.next()}get sources(){return this._sources}set sources(value){const dp=this._dataPackage;this._unlistenToSources?.(),this._sources=value,null!=dp&&this._sources.forEach((s=>s.connect(dp,!1)));const handlers=this._sources.map((v=>v.onChange((()=>this._onChange.next()))));this._unlistenToSources=()=>handlers.forEach((h=>h())),this._onChange.next()}get isConnected(){return null!=this._dataPackage}connect(dp,top=!0){this._dataPackage=dp,dp.addResource(this,top),this._sources.filter((s=>!s.isReference())).forEach((s=>s.connect(dp,!1)))}getSourcesWithProfile(type){return this.sources.map(predicates.hM).filter((s=>s?.profile===type))}toSchema(){return{...super.toSchema(),$schema:this.$schema,profile:this.profile,path:this.path,rel:this.rel,homepage:this.homepage,license:this.license}}loadSchema(value,quiet=!1){super.loadSchema(value,!0),this._path=value?.path,this._homepage=value?.homepage,this._license=value?.license,this._rel=value?.rel,quiet||this._onChange.next()}dispose(){super.dispose(),this._sources.forEach((s=>s.dispose())),this._dataPackage=void 0}constructor(...args){super(...args),Resource_define_property(this,"_path",void 0),Resource_define_property(this,"_rel",void 0),Resource_define_property(this,"_homepage",void 0),Resource_define_property(this,"_license",void 0),Resource_define_property(this,"_sources",[]),Resource_define_property(this,"_dataPackage",void 0),Resource_define_property(this,"_unlistenToSources",void 0)}}},"../../.yarn/__virtual__/@datashaper-workflow-virtual-9a99b417c8/1/javascript/workflow/src/resources/Workflow/Workflow.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{h:()=>Workflow});var verbs_namespaceObject={};__webpack_require__.r(verbs_namespaceObject),__webpack_require__.d(verbs_namespaceObject,{aggregate:()=>aggregate,bin:()=>bin,binarize:()=>binarize,boolean:()=>boolean_boolean,concat:()=>concat,convert:()=>convert,copy:()=>copy,decode:()=>decode,dedupe:()=>dedupe,derive:()=>derive,destructure:()=>destructure,difference:()=>difference,drop:()=>drop,encode:()=>encode,erase:()=>erase,fill:()=>fill,filter:()=>filter,fold:()=>fold,groupby:()=>groupby,impute:()=>impute,intersect:()=>intersect,join:()=>join,lookup:()=>lookup,merge:()=>merge,onehot:()=>onehot,orderby:()=>orderby,pivot:()=>pivot,print:()=>print,recode:()=>recode,rename:()=>rename,rollup:()=>rollup,sample:()=>sample,select:()=>select_select,spread:()=>spread,strings:()=>strings,unfold:()=>unfold,ungroup:()=>ungroup,unhot:()=>unhot,union:()=>union,unorder:()=>unorder,unroll:()=>unroll,window:()=>window_window,workflow:()=>workflow});var browser=__webpack_require__("../../.yarn/__virtual__/debug-virtual-a4fdb8ad60/0/cache/debug-npm-4.3.4-4513954577-0073c3bcbd.zip/node_modules/debug/src/browser.js"),browser_default=__webpack_require__.n(browser),factories=__webpack_require__("../schema/src/factories.ts"),Profile=__webpack_require__("../schema/src/enums/Profile.ts"),empty=__webpack_require__("../../.yarn/cache/rxjs-npm-7.8.1-41c443a75b-b10cac1a52.zip/node_modules/rxjs/dist/esm5/internal/observable/empty.js"),map=__webpack_require__("../../.yarn/cache/rxjs-npm-7.8.1-41c443a75b-b10cac1a52.zip/node_modules/rxjs/dist/esm5/internal/operators/map.js"),of=__webpack_require__("../../.yarn/cache/rxjs-npm-7.8.1-41c443a75b-b10cac1a52.zip/node_modules/rxjs/dist/esm5/internal/observable/of.js"),BehaviorSubject=__webpack_require__("../../.yarn/cache/rxjs-npm-7.8.1-41c443a75b-b10cac1a52.zip/node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js");class DelegateSubject extends BehaviorSubject.X{set input(source$){this.detach(),null!=source$?this._subscription=source$.subscribe((v=>this.next(v))):this.next(void 0)}detach(){this._subscription?.unsubscribe(),this._subscription=void 0}dispose(){this._subscription?.unsubscribe(),this._subscription=void 0,this.complete()}constructor(value){super(value??void 0),function _define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}(this,"_subscription",void 0)}}function TableManager_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const log=browser_default()("datashaper:workflow");var RemoveMode;!function(RemoveMode){RemoveMode.Hard="hard",RemoveMode.Soft="soft"}(RemoveMode||(RemoveMode={}));class TableManager{get defaultInput$(){return this._defaultInput$}get defaultOutput$(){return this._defaultOutput$}set defaultInput$(source){this._defaultInput$.input=source}set defaultOutput$(source){this._defaultOutput$.input=source}get defaultInput(){return this._defaultInput$.value}set defaultInput(source){log(`set default input source, ${null!=source}`),this._defaultInput$.next(source)}get(id){return this.get$(id).value}get$(id){const found=this._tables.get(id);if(!found)throw new Error(`No table with id ${id}`);return found}bind(id,source){const[subject]=this.ensure(id);return subject.input=source,subject}remove(id,mode){const existing=this._tables.get(id);null!=existing&&(mode===RemoveMode.Hard?(existing.dispose(),this._tables.delete(id)):existing.input=void 0)}ensure(id){let created=!1;this._tables.has(id)||(this._tables.set(id,new DelegateSubject),created=!0);const result=this._tables.get(id);if(null==result)throw new Error(`could not get table with id ${id}`);return[result,created]}dispose(){for(const t of this._tables.values())t.dispose();this._defaultInput$.dispose(),this._defaultOutput$.dispose()}toArray(names,includeDefaultInput,includeDefaultOutput){const result=[];return includeDefaultInput&&result.push(this._defaultInput$.value),names.forEach((name=>result.push(this.get(name)))),includeDefaultOutput&&result.push(this._defaultOutput$.value),result}constructor(){TableManager_define_property(this,"_defaultOutput$",new DelegateSubject),TableManager_define_property(this,"_defaultInput$",new DelegateSubject),TableManager_define_property(this,"_tables",new Map)}}var Resource=__webpack_require__("../../.yarn/__virtual__/@datashaper-workflow-virtual-9a99b417c8/1/javascript/workflow/src/resources/Resource.ts"),from=__webpack_require__("../../.yarn/cache/rxjs-npm-7.8.1-41c443a75b-b10cac1a52.zip/node_modules/rxjs/dist/esm5/internal/observable/from.js"),dist=__webpack_require__("../../.yarn/cache/@essex-toposort-npm-2.0.0-4a5c478cff-a6f2fa9cf6.zip/node_modules/@essex/toposort/dist/index.js");function DefaultGraph_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class DefaultGraph{clear(){for(const sub of Object.values(this._nodeBindingSubscriptions))sub.unsubscribe();this._nodeBindingSubscriptions.clear(),this._nodes.clear()}get nodes(){return[...this._nodes.keys()]}hasNode(id){return this._nodes.has(id)}node(id){const result=this._nodes.get(id);if(!result)throw new Error(`could not find node with id "${id}"`);return result}add(node){if(!this._nodes.has(node.id)){this._nodes.set(node.id,node);for(const b of node.bindings)this.add(b.node);const subscription=node.bindings$.subscribe((bindings=>{for(const b of bindings)this.add(b.node)}));this._nodeBindingSubscriptions.set(node.id,subscription)}}remove(removeId){if(this.hasNode(removeId)){for(const innerNodeId of this._nodes.keys()){const node=this._nodes.get(innerNodeId);for(const binding of node?.bindings??[])binding.node.id===removeId&&node?.unbind(binding.input)}this._nodes.delete(removeId),this._nodeBindingSubscriptions.delete(removeId)}}validate(){(0,dist.l)(this.edges)}get edges(){const edges=[];for(const id of this.nodes){const node=this._nodes.get(id);if(node)for(const b of node.bindings)edges.push([b.node.id,id])}return edges}printStats(){const nodeInfo=[...this._nodes.values()].map((n=>{const{id,version,recalculations,recalculationCauses}=n.stats;return`  Node[${id}]: Version ${version}; ${recalculations} recalculations ${JSON.stringify(recalculationCauses)}`})).join("\n");console.log(`Graph Stats\n${nodeInfo}`)}constructor(){DefaultGraph_define_property(this,"_nodes",new Map),DefaultGraph_define_property(this,"_nodeBindingSubscriptions",new Map)}}var v4=__webpack_require__("../../.yarn/cache/uuid-npm-9.0.0-46c41e3e43-23857699a6.zip/node_modules/uuid/dist/esm-browser/v4.js"),types=__webpack_require__("../../.yarn/__virtual__/@datashaper-workflow-virtual-9a99b417c8/1/javascript/workflow/src/dataflow/types.ts");function BaseNode_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const BaseNode_log=browser_default()("datashaper:BaseNode"),DEFAULT_INPUT_NAME=types.o.Source,DEFAULT_OUTPUT_NAME=types.u.Result;class BaseNode{get inputs(){return this._inputs}get outputs(){return this._outputs}set inputs(value){for(const name of this._inputValues$.keys())isDefaultInput(name)||value.includes(name)||(this._inputValues$.get(name)?.complete(),this._inputErrors$.get(name)?.complete(),this._inputValues$.delete(name),this._inputErrors$.delete(name));this._inputs=value;for(const input of value)this.ensureInput(input)}set outputs(value){for(const name of this._output$.keys())isDefaultOutput(name)||value.includes(name)||(this._output$.get(name)?.complete(),this._output$.delete(name));this._outputs=value;for(const output of value)this.ensureOutput(output)}get stats(){return{id:this.id,version:this._version,recalculations:this._recalculations,recalculationCauses:this._recalculationCauses}}get config$(){return this._config$}get config(){return this._config$.value}set config(value){value!==this.config&&(this._config$.next(value),BaseNode_log(`${this.id} set config`),(!this.isBindingRequired||this.bindings.length>0)&&this.recalculate("configure"))}get isBindingRequired(){return!0}binding(name=DEFAULT_INPUT_NAME){return name=this.verifyInputSocketName(name),this.bindings.find((i=>i.input===name))}get bindings$(){return this._bindings$}get bindings(){return this._bindings$.value}inputValue(name=DEFAULT_INPUT_NAME){return this.inputValue$(name)?.value}inputValue$(name=DEFAULT_INPUT_NAME){return this.ensureInput(name),this._inputValues$.get(name)}inputError(name=DEFAULT_INPUT_NAME){return this.inputError$(name)?.value}inputError$(name=DEFAULT_INPUT_NAME){return this.ensureInput(name),this._inputErrors$.get(name)}getInputValues(){const result={};for(const input of this.inputs)result[input]=this._inputValues$.get(input)?.value;return result}getVariadicInputValues(){return this._getVariadicInputs?.()??[]}getInputErrors(){const result={};for(const input of this.inputs)result[input]=this.inputError(input);return result}output$(name=DEFAULT_OUTPUT_NAME){return this.ensureOutput(name),this._output$.get(name)}output(name=DEFAULT_OUTPUT_NAME){return this.output$(name).value}bind(binding){const bindVariadic=binding=>{this._disposeVariadicInputs?.();const values=binding.map((()=>{})),subs=binding.map(((i,index)=>{if(i.node===this)throw new Error("cannot bind to self");return i.node.output$(i.output).subscribe((v=>{values[index]=v,this.recalculate(`input_variadic@${i}`)}))}));this._disposeVariadicInputs=()=>{for(const sub of subs)sub.unsubscribe()},this._getVariadicInputs=()=>values,this.recalculate("bindvar")},bindSingleInput=binding=>{BaseNode_log(`${this.id} binding to ${binding.node.id}@${binding.output}`);const input=this.verifyInputSocketName(binding.input),values=this.inputValue$(input),errors=this.inputError$(input);this.unbindSilent(input),(()=>{this._bindings$.next([...this.bindings.filter((i=>i.input!==input)),binding])})(),(()=>{const outputSocket=binding.node.output$(binding.output);if(BaseNode_log(`${this.id} listening to ${binding.node.id}@${binding.output}`),binding.node===this)throw new Error("cannot bind to self");this._inputSubscriptions.set(input,outputSocket.subscribe({next:value=>{BaseNode_log(`${this.id} receive ${null==value?value:"valid value"}`),null!=errors.value&&errors.next(void 0),values.value!==value&&(values.next(value),this.recalculate(`input@${String(input)}[${binding.node.id}]`))},error:error=>{BaseNode_log(`${this.id} error from ${binding.node.id}`,error),values.next(void 0),errors.next(error),this?.recalculate("input_error")}}))})()};Array.isArray(binding)?bindVariadic(binding):bindSingleInput(binding)}hasBoundInputWithNode(name,nodeId,output){return this.bindings.some((i=>this.isSocketNameEqual(i.input,name)&&i.node.id===nodeId&&output===i.output))}hasBoundInput(name){return this.bindings.some((i=>this.isSocketNameEqual(i.input,name)))}isSocketNameEqual(name,name2){return name===name2||isDefaultInput(name)&&isDefaultInput(name2)}unbind(name){if(name=this.verifyInputSocketName(name),BaseNode_log(`${this.id} unbinding socket ${String(name)}`),!this.hasBoundInput(name))throw new Error(`no socket installed at "${String(name)}"`);this.unbindSilent(name),this.recalculate("unbind")}unbindSilent(name){this._bindings$.value.some((i=>i.input===name))&&this._bindings$.next(this._bindings$.value.filter((i=>i.input!==name))),this._inputSubscriptions.get(name)?.unsubscribe(),this._inputSubscriptions.delete(name)}ensureInput(name){if(name=this.verifyInputSocketName(name),!this._inputValues$.has(name)){const input$=new BehaviorSubject.X(void 0),error$=new BehaviorSubject.X(void 0);this._inputValues$.set(name,input$),this._inputErrors$.set(name,error$)}}ensureOutput(name){if(name=this.verifyOutputSocketName(name),!this._output$.has(name)){const output$=new BehaviorSubject.X(void 0);this._output$.set(name,output$)}}verifyInputSocketName(name=DEFAULT_INPUT_NAME){if(isDefaultInput(name))return DEFAULT_INPUT_NAME;if(!this.inputs.some((s=>s===name)))throw new Error(`unknown input socket name "${String(name)}"`);return name}verifyOutputSocketName(name){if(isDefaultOutput(name))return DEFAULT_OUTPUT_NAME;if(!this.outputs.some((s=>String(s)===String(name))))throw new Error(`unknown output socket name "${String(name)} of ${this.outputs.map((s=>String(s))).join(", ")}"`);return name}constructor(inputs=[],outputs=[]){BaseNode_define_property(this,"id",(0,v4.Z)()),BaseNode_define_property(this,"_version",0),BaseNode_define_property(this,"_recalculations",0),BaseNode_define_property(this,"_recalculationCauses",{}),BaseNode_define_property(this,"_config$",new BehaviorSubject.X(void 0)),BaseNode_define_property(this,"_output$",new Map),BaseNode_define_property(this,"_bindings$",new BehaviorSubject.X([])),BaseNode_define_property(this,"_inputValues$",new Map),BaseNode_define_property(this,"_inputErrors$",new Map),BaseNode_define_property(this,"_inputSubscriptions",new Map),BaseNode_define_property(this,"_disposeVariadicInputs",void 0),BaseNode_define_property(this,"_getVariadicInputs",void 0),BaseNode_define_property(this,"_inputs",[]),BaseNode_define_property(this,"_outputs",[]),BaseNode_define_property(this,"recalculate",(cause=>{try{this._recalculations++,null==this._recalculationCauses[cause]&&(this._recalculationCauses[cause]=0),this._recalculationCauses[cause]++,this.doRecalculate()}catch(err){BaseNode_log(`recalculation error in node ${this.id}`,err),this.emitError(err)}})),BaseNode_define_property(this,"emit",((value,socketName=DEFAULT_OUTPUT_NAME)=>{const socket=this.output$(socketName);value!==socket.value&&(BaseNode_log(`${this.id} emitting ${null==value?"undefined":"value"}`),this._version++,socket.next(value))})),BaseNode_define_property(this,"emitError",((error,socketName=DEFAULT_OUTPUT_NAME)=>{this.output$(socketName).error(error)})),this.inputs=inputs,this.outputs=outputs,this.ensureInput(DEFAULT_INPUT_NAME),this.ensureOutput(DEFAULT_OUTPUT_NAME)}}const isDefaultInput=name=>void 0===name||name===DEFAULT_INPUT_NAME,isDefaultOutput=name=>void 0===name||name===DEFAULT_OUTPUT_NAME;class ObservableNode extends BaseNode{doRecalculate(){}constructor(source){super(),source.subscribe({next:value=>this.emit(value),error:error=>this.emitError(error)})}}function observableNode(id,source){const result=new ObservableNode(source);return result.id=id,result}var Disposable=__webpack_require__("../../.yarn/__virtual__/@datashaper-workflow-virtual-9a99b417c8/1/javascript/workflow/src/resources/Disposable.ts"),container=__webpack_require__("../../.yarn/__virtual__/@datashaper-tables-virtual-cb2f1a5962/1/javascript/tables/src/container.ts");function StepNode_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class StepNode extends BaseNode{get stepApi(){return this._stepApi}doRecalculate(){const source=this.inputValue();if(null!=source&&null!=this.config){const output=this._step(source,this.config,this.stepApi);this.emit(output)}else{this.emit(void 0);for(const output of this.outputs)this.emit(void 0,output)}}constructor(step,inputs,outputs){super(inputs,outputs),StepNode_define_property(this,"_step",void 0),StepNode_define_property(this,"_stepApi",{input:name=>this.inputValue(name),emit:(value,name)=>this.emit(value,name)}),this._step=step.bind(this)}}var verbs=__webpack_require__("../schema/src/workflow/verbs.ts");class SetOperationNode extends BaseNode{doRecalculate(){const source=this.inputValue();if(null!=source?.table){const others=this.getVariadicInputValues().filter((t=>!!t)).map((o=>o?.table)).filter((t=>!!t));this.emit((0,container.n)(this.id,function set(input,op,others){return input[op===verbs.ig.Difference?"except":op](...others)}(source.table,this.op,others)))}else this.emit(void 0)}constructor(op){super(),function factories_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}(this,"op",void 0),this.op=op}}function stepVerbFactory(columnTableStep,inputs,outputs){return id=>{const result=new StepNode((function step(source,args,api){const subapi={emit:(value,socket)=>{const tableId=null==socket?id:`${id}.${String(socket)}`;api.emit((0,container.n)(tableId,value),socket)},input:socket=>{const input=this.inputValue(socket);if(input)return input.table}};if(null==source.table)return(0,container.n)(id);let result;try{result=columnTableStep(source.table,args,subapi)}catch(err){console.warn("error processing step",err),this.emitError(err)}return(0,container.n)(id,result)}),inputs,outputs);return result.id=id,result}}function setOperationNodeFactory(op){return id=>{const result=new SetOperationNode(op);return result.id=id,result}}var src=__webpack_require__("../../.yarn/cache/arquero-npm-5.4.0-7652cf4e19-b2cb2e2d9e.zip/node_modules/arquero/src/index.js");function evaluateBoolean(comparisons,logical){switch(logical){case verbs._W.OR:return function or(comparisons){let nulls=0;for(let i=0;i<comparisons.length;i++)if(null===comparisons[i])nulls++;else if(1===comparisons[i])return 1;if(nulls>=1||0===comparisons.length)return null;return 0}(comparisons);case verbs._W.AND:return function and(comparisons){let nulls=0;for(let i=0;i<comparisons.length;i++){if(0===comparisons[i])return 0;null===comparisons[i]&&nulls++}if(nulls>=1||0===comparisons.length)return null;return 1}(comparisons);case verbs._W.XOR:return xor(comparisons);case verbs._W.NOR:return function nor(comparisons){let nulls=0;for(let i=0;i<comparisons.length;i++){if(1===comparisons[i])return 0;null===comparisons[i]&&nulls++}if(nulls>0||0===comparisons.length)return null;return 1}(comparisons);case verbs._W.NAND:return function nand(comparisons){if(0===comparisons.length)return null;let nand=0;for(let i=0;i<comparisons.length;i++){const val=comparisons[i];if(null!=val&&(nand+=val,0===val))return 1}if(nand===comparisons.length)return 0;return null}(comparisons);case verbs._W.XNOR:return function xnor(comparisons){const xorResult=xor(comparisons);return null===xorResult?null:1===xorResult?0:1}(comparisons);default:throw new Error(`Unsupported logical operator: [${logical}]`)}}function xor(comparisons){let xor=0;if(0===comparisons.length)return null;for(let i=0;i<comparisons.length;i++){if(null===comparisons[i])return null;xor+=null===comparisons[i]?0:1===comparisons[i]?1:0}return xor%2!=0&&0!==xor?1:0}function bool(value){return null==value?null:"false"!==value&&!!value}function compare_compareValues(left,right,operator){if(operator===verbs.ZB.IsEmpty||operator===verbs.NQ.IsEmpty||operator===verbs.rA.IsEmpty||operator===verbs.v_.IsEmpty)return isEmpty(left);if(operator===verbs.ZB.IsNotEmpty||operator===verbs.NQ.IsNotEmpty||operator===verbs.rA.IsNotEmpty||operator===verbs.v_.IsNotEmpty){return 1===isEmpty(left)?0:1}if(isEmpty(left)||isEmpty(right))return null;if("number"==typeof left&&null!=right){return function compareNumbers(left,right,operator){switch(operator){case verbs.ZB.Equals:return left===right?1:0;case verbs.ZB.NotEqual:return left!==right?1:0;case verbs.ZB.GreaterThanOrEqual:return left>=right?1:0;case verbs.ZB.LessThanOrEqual:return left<=right?1:0;case verbs.ZB.GreaterThan:return left>right?1:0;case verbs.ZB.LessThan:return left<right?1:0;default:throw new Error(`Unsupported numeric comparison operator: [${operator}]`)}}(left,+right,operator)}if("string"==typeof left)return function compareStrings(left,right,operator){const ll=left.toLocaleLowerCase(),rl=right.toLocaleLowerCase();switch(operator){case verbs.NQ.Contains:case verbs.NQ.RegularExpression:return src.op.match(ll,new RegExp(rl,"gi"),0)?1:0;case verbs.NQ.EndsWith:return src.op.endswith(ll,rl,ll.length)?1:0;case verbs.NQ.Equals:return 0===ll.localeCompare(rl)?1:0;case verbs.NQ.NotEqual:return 0!==ll.localeCompare(rl)?1:0;case verbs.NQ.StartsWith:return src.op.startswith(ll,rl,0)?1:0;default:throw new Error(`Unsupported string comparison operator: [${operator}]`)}}(left,`${right}`,operator);if("boolean"==typeof left){return function compareBooleans(left,right,operator){switch(operator){case verbs.rA.Equals:return left===right?1:0;case verbs.rA.NotEqual:return left!==right?1:0;case verbs.rA.IsTrue:return!0===left?1:0;case verbs.rA.IsFalse:return!1===left?1:0;default:throw new Error(`Unsupported boolean comparison operator: [${operator}]`)}}(left,!!bool(right),operator)}return"object"==typeof left&&left instanceof Date?function compareDates(left,right,operator){switch(operator){case verbs.v_.Equals:return left.getTime()===right.getTime()?1:0;case verbs.v_.NotEqual:return left.getTime()!==right.getTime()?1:0;case verbs.v_.After:return left>right?1:0;case verbs.v_.Before:return left<right?1:0;default:throw new Error(`Unsupported date comparison operator: [${operator}]`)}}(left,right,operator):0}function isEmpty(value){return null==value||"number"==typeof value&&isNaN(value)||"string"==typeof value&&0===value.length?1:0}function compareAll(column,criteria,logical=verbs._W.OR){return(0,src.YU)((d=>{const left=d[column],comparisons=criteria.map((filter=>{const{value,operator,type}=filter,right=type===verbs.X$.Column?d[`${value.toString()}`]:value;return compare_compareValues(left,right,operator)}));return evaluateBoolean(comparisons,logical)}))}function deriveBoolean(columns,operator){return(0,src.YU)((d=>evaluateBoolean(columns.map((c=>{const val=bool(d[c]);return null===val?null:val?1:0})),operator)))}const fieldOps=new Set([...Object.values(verbs.Ei),...Object.values(verbs.dx)]);function singleExpression(column,operation){if(!fieldOps.has(operation))throw new Error(`Unsupported operation [${operation}], too many parameters needed`);return src.op[operation](column)}(0,src.yJ)(verbs.dx.UUID,{create:()=>({init:()=>{},value:column=>null!==column?(0,v4.Z)():""}),param:[1,0]});const aggregate=stepVerbFactory(((input,{groupby,column,operation,to})=>{const expr=singleExpression(column,operation);return input.groupby(groupby).rollup({[to]:expr})}));var binning=__webpack_require__("../../.yarn/__virtual__/@datashaper-tables-virtual-cb2f1a5962/1/javascript/tables/src/binning.ts"),exact_linspace_es5=__webpack_require__("../../.yarn/cache/exact-linspace-npm-1.0.15-26bc29cac7-ec3931f165.zip/node_modules/exact-linspace/dist/exact-linspace.es5.js"),lib=__webpack_require__("../../.yarn/cache/percentile-npm-1.6.0-4b24a6c163-3d8d6f929a.zip/node_modules/percentile/lib/index.js"),lib_default=__webpack_require__.n(lib);function calculateWidthFd(values){const iqrResult=function iqr(values){values.sort(ascending);const q1=lib_default()(25,values),q3=lib_default()(75,values);return q3-q1}(values);return 2*iqrResult*Math.pow(values.length,-1/3)}function calculateWidthSturges(min,max,values){return(max-min)/(Math.log2(values.length)+1)}function standardDeviation(values,precision=3){const N=values.length;let sum=0,squareNumbersSum=0;values.forEach((val=>{sum+=val,squareNumbersSum+=val*val}));const variance=(squareNumbersSum-sum*sum/N)/(N-1),stddev=Math.sqrt(variance);return Number(stddev.toFixed(precision))}function ascending(a,b){return a-b}function estimateBinValues(min,max,strategy,values,nice){let width=function estimateWidth(strategy,values,min,max){switch(strategy){case verbs.Lo.Auto:return function calculateWidthAuto(min,max,values){const fdResult=calculateWidthFd(values),sturgesResult=calculateWidthSturges(min,max,values);return Math.min(fdResult,sturgesResult)||Math.max(fdResult,sturgesResult)}(min,max,values);case verbs.Lo.Fd:return calculateWidthFd(values);case verbs.Lo.Doane:return function calculateWidthDoane(min,max,values){if(values.length>2){const sg1=Math.sqrt(6*(values.length-2)/((values.length+1)*(values.length+3))),sigma=standardDeviation(values);if(sigma>0){const temp=[],mean=values.reduce(((a,b)=>a+b),0)/values.length;values.forEach((element=>{temp.push(element-mean)}));for(let i=0;i<temp.length;i++){const val=temp[i];null!=val&&(temp[i]=val/sigma)}for(let i=0;i<temp.length;i++){const val=temp[i];null!=val&&(temp[i]=Math.pow(val,3))}const g1=temp.reduce(((a,b)=>a+b),0)/temp.length;return(max-min)/(1+Math.log2(values.length)+Math.log2(1+Math.abs(g1)/sg1))}}return 0}(min,max,values);case verbs.Lo.Scott:return function calculateWidthScott(values){return Math.pow(24*Math.pow(Math.sqrt(Math.PI),.5)/values.length,1/3)*standardDeviation(values)}(values);case verbs.Lo.Rice:return function calculateWidthRice(min,max,values){return(max-min)/(2*Math.pow(values.length,1/3))}(min,max,values);case verbs.Lo.Sturges:return calculateWidthSturges(min,max,values);case verbs.Lo.Sqrt:return function calculateWidthSqrt(min,max,values){return(max-min)/Math.sqrt(values.length)}(min,max,values);default:throw new Error(`Unsupported bin strategy ${strategy}`)}}(strategy,values,min,max);if(nice){const adjustedValues=function calculateNiceRounding(min,max,step){return[roundNumber(min,Opts.Down),roundNumber(max,Opts.Up),roundNumber(step,Opts.Up)]}(min,max,width),[minValue,maxValue,widthValue]=adjustedValues;min=minValue,max=maxValue,width=widthValue}const numBins=function calculateBinCount(min,max,width){return 0===width?1:Math.round(Math.ceil((max-min)/width))}(min,max,width),binEdges=(0,exact_linspace_es5.Z)(min,max,numBins+1),binMax=binEdges[1],binMin=binEdges[0];if(null==binMax||null==binMin)throw new Error(`invalid bin boundaries [${binMin}, ${binMax}]`);return[min,max,binMax-binMin]}function roundNumber(value,opt){const str=value.toString(),decimals=str.split("."),whole=decimals[0]??"0",fractional=decimals[1]??"",numberOfDecimals=function getNumberOfDecimals(value){const decimals=value.split(".");return void 0!==decimals[1]?decimals[1].length:0}(str);if(value<1&&numberOfDecimals>10){const rounding=opt===Opts.Down?"0":"9",fractionalPreRounding=fractional.substring(0,3),fractionalPostRounding=fractional.substring(0,4),finalNumber=Number(`${whole}.${fractionalPreRounding}${rounding}${fractionalPostRounding}`);return Number(finalNumber.toFixed(3))}if(value<1&&numberOfDecimals<=10){const finalNumber=Number(`${whole}.${fractional.substring(0,numberOfDecimals/3)}${opt===Opts.Down?"0":"9"}${fractional.substring(numberOfDecimals/3+1)}`);return Number(finalNumber.toFixed(numberOfDecimals/3))}if(whole.length>1){const finalNumber=Number(str.substring(0,1)+(opt===Opts.Down?"0":"9")+str.substring(2));return Number(finalNumber.toPrecision(1))}if(whole.length<=1&&decimals.length>1){const finalNumber=Number(whole+(opt===Opts.Down?".0":".9"));return Number(finalNumber.toPrecision(1))}return Number(value.toPrecision(1))}var Opts;!function(Opts){Opts[Opts.Down=0]="Down",Opts[Opts.Up=1]="Up"}(Opts||(Opts={}));function binExpr(input,args){const{column,clamped,printRange=!1}=args,[min,max,step]=function computeBins(input,args){const{strategy,column,fixedwidth,fixedcount,nice}=args,stats=function getStats(table,column,min,max){return[min||table.rollup({min:src.op.min(column)}).get("min",0),max||table.rollup({max:src.op.max(column)}).get("max",0)]}(input,column,args.min,args.max),[min,max]=stats;switch(strategy){case verbs.Lo.FixedWidth:if(!fixedwidth)throw new Error("Must supply a bin width");return[min,max,fixedwidth];case verbs.Lo.FixedCount:if(!fixedcount)throw new Error("Must supply a bin count");return[min,max,(max-min)/fixedcount];default:return estimateBinValues(min,max,strategy,input.array(column),nice)}}(input,args);return(0,binning.z)(column,min,max,step,clamped,printRange)}const bin=stepVerbFactory(((input,args)=>input.derive({[args.to]:binExpr(input,args)}))),binarize=stepVerbFactory(((input,{to,column,criteria,logical})=>input.derive({[to]:compareAll(column,criteria,logical)}))),boolean_boolean=stepVerbFactory(((input,{columns=[],operator,to})=>input.derive({[to]:deriveBoolean(columns,operator)}))),concat=setOperationNodeFactory(verbs.ig.Concat);var data=__webpack_require__("../schema/src/data.ts"),src_data=__webpack_require__("../../.yarn/__virtual__/@datashaper-tables-virtual-cb2f1a5962/1/javascript/tables/src/data.ts"),defaultLocale=__webpack_require__("../../.yarn/cache/d3-time-format-npm-4.1.0-7f352c4634-ffc0959258.zip/node_modules/d3-time-format/src/defaultLocale.js"),isoParse=__webpack_require__("../../.yarn/cache/d3-time-format-npm-4.1.0-7f352c4634-ffc0959258.zip/node_modules/d3-time-format/src/isoParse.js");function parseType(column,type,radix,delimiter,formatPattern){const parseTime=(0,defaultLocale.Z1)(formatPattern??"%Y-%m-%d"),formatTime=(0,defaultLocale.i$)(formatPattern??"%Y-%m-%d");return(0,src.YU)((d=>{const value=d[column],inputType=(0,src_data.wj)(value);switch(type){case verbs.rJ.Boolean:return bool(value);case verbs.rJ.Date:return null===value||isNaN(value)?"%Y-%m-%dT%H:%M:%S.%LZ"===formatPattern?(0,isoParse.Z)(value):parseTime(value):new Date(value);case verbs.rJ.Integer:return function parseInteger(value,radix){const val=src.op.parse_int(value,radix);return isNaN(val)?null:val}(value,radix);case verbs.rJ.Decimal:return function parseDecimal(value){const val=src.op.parse_float(value);return isNaN(val)?null:val}(value);case verbs.rJ.Array:return src.op.split(value,delimiter,1e7);case verbs.rJ.String:if(inputType===data.g.String&&"undefined"===value.trim().toLowerCase())return;return inputType===data.g.String&&"null"===value.trim().toLowerCase()?null:value instanceof Date?formatTime(value):inputType===data.g.Array?src.op.join(value,delimiter):null!=value?value.toString():value}}))}const convert=stepVerbFactory(((input,{column,type,radix,delimiter,to,formatPattern})=>{const dArgs={[to]:parseType(column,type,radix,delimiter,formatPattern)};return input.derive(dArgs)})),copy=stepVerbFactory(((input,{column,to})=>{const func=(0,src.YU)((d=>d[column]));return input.derive({[to]:func})}));var parseTypes=__webpack_require__("../../.yarn/__virtual__/@datashaper-tables-virtual-cb2f1a5962/1/javascript/tables/src/parseTypes.ts");const decode=stepVerbFactory(((input,{strategy,codebook})=>function unapplyCodebook(table,codebook,strategy,dataTableSchema){let applied=table;if(strategy===verbs.ZN.DataTypeOnly||strategy===verbs.ZN.DataTypeAndMapping){const args=table.columnNames().reduce(((acc,cur)=>{const parser=null!=dataTableSchema?.typeHints?(0,parseTypes.BY)(data.g.String,data.g.String,dataTableSchema.typeHints):(0,parseTypes.BY)(data.g.String,data.g.String);return acc[cur]=(0,src.YU)((d=>parser(d[cur]))),acc}),{});applied=table.derive(args)}if(strategy===verbs.ZN.MappingOnly||strategy===verbs.ZN.DataTypeAndMapping){const args2=codebook.fields.filter((element=>null!=element.mapping)).reduce(((acc,cur)=>{const finalMap={};for(const key in cur.mapping){const value=cur.mapping[key];finalMap[value]=key}return acc[cur.name]=(0,src.YU)((d=>src.op.recode(d[cur.name],finalMap))),acc}),{});return applied.derive(args2)}return applied}(input,codebook,strategy))),dedupe=stepVerbFactory(((input,{columns})=>columns?input.dedupe(columns):input.dedupe())),derive=stepVerbFactory(((input,{column1,column2,operator,to})=>{const func=(0,src.YU)((d=>{const l=d[column1],r=d[column2];let result;switch(operator){case verbs.Vr.Add:if("number"!=typeof l||"number"!=typeof r)return`${l}${r}`;result=l+r;break;case verbs.Vr.Subtract:result=l-r;break;case verbs.Vr.Multiply:result=l*r;break;case verbs.Vr.Divide:result=l/r;break;default:throw new Error(`Unsupported operator: [${operator}]`)}return isNaN(result)?null:result}));return input.derive({[to]:func})})),difference=setOperationNodeFactory(verbs.ig.Difference),drop=stepVerbFactory(((input,{columns=[]})=>input.select((0,src.ff)(columns))));var applyCodebook=__webpack_require__("../../.yarn/__virtual__/@datashaper-tables-virtual-cb2f1a5962/1/javascript/tables/src/applyCodebook.ts");const encode=stepVerbFactory(((input,{strategy,codebook})=>(0,applyCodebook.K)(input,codebook,strategy))),erase=stepVerbFactory(((input,{value,column})=>input.derive({[column]:(0,src.YU)((d=>`${d[column]}`==`${value}`?null:d[column]))}))),fill=stepVerbFactory(((input,{value,to})=>input.params({value}).derive({[to]:(_d,$)=>$.value}))),filter=stepVerbFactory(((input,{column,criteria,logical})=>input.filter(compareAll(column,criteria,logical)))),fold=stepVerbFactory(((input,{columns,to})=>input.fold(columns,{as:to}))),groupby=stepVerbFactory(((input,{columns})=>input.groupby(columns))),impute=stepVerbFactory(((input,{value,column})=>{const dArgs={[column]:(_d,$)=>$.value};return input.params({value}).impute(dArgs)})),intersect=setOperationNodeFactory(verbs.ig.Intersect);class JoinNode extends BaseNode{doRecalculate(){const left=this.inputValue(),right=this.inputValue(types.o.Other);null!=left?.table&&null!=right?.table&&null!=this.config?this.emit((0,container.n)(this.id,function doJoin(input,other,{on,strategy=verbs.Fo.Inner}){switch(strategy){case verbs.Fo.SemiJoin:return input.semijoin(other,on);case verbs.Fo.AntiJoin:return input.antijoin(other,on);case verbs.Fo.Cross:return input.cross(other);default:return input.join(other,on,void 0,{left:strategy===verbs.Fo.LeftOuter||strategy===verbs.Fo.FullOuter,right:strategy===verbs.Fo.RightOuter||strategy===verbs.Fo.FullOuter})}}(left.table,right.table,this.config))):this.emit(void 0)}constructor(id){super([types.o.Other]),this.id=id}}function join(id){return new JoinNode(id)}class LookupNode extends BaseNode{doRecalculate(){const input=this.inputValue(),other=this.inputValue(types.o.Other);null!=input?.table&&null!=other?.table&&null!=this.config?this.emit((0,container.n)(this.id,function doLookup(input,other,{on=[],columns}){return input.lookup(other,on,...columns)}(input.table,other.table,this.config))):this.emit(void 0)}constructor(id){super([types.o.Other]),this.id=id}}function lookup(id){return new LookupNode(id)}function firstOneWinsStrategy(singleRow,columns){const firstCol=columns[0];if(null==firstCol)throw new Error("no valid first column");let firstValidValue=singleRow[firstCol],foundFirstValidValue=!1,i=0;for(;!foundFirstValidValue&&i<columns.length;){const col=columns[i];if(null!=col){const sr=singleRow[col];null!=sr&&(firstValidValue=sr,foundFirstValidValue=!0)}i++}return firstValidValue}function arrayStrategy(singleRow,columns){const concat=[];for(let i=0;i<columns.length;i++){const col=columns[i];if(null!=col){const sr=singleRow[col];null!=sr&&concat.push(sr)}}return concat}function unhotOperation(input,columns,prefix=""){const args=columns.reduce(((acc,cur)=>{const pxp=new RegExp(`^${prefix}`),value=cur.replace(pxp,"");return acc[cur]=(0,src.YU)((d=>1===d[cur]?value:null)),acc}),{});return input.derive(args)}const merge=stepVerbFactory(((input,{columns=[],strategy,to,delimiter="",unhot=!1,prefix="",preserveSource=!1})=>{const tempTable=unhot?unhotOperation(input,columns,prefix):input,func=(0,src.YU)((d=>{switch(strategy){case verbs.Kp.LastOneWins:return function lastOneWinsStrategy(singleRow,columns){const firstCol=columns[0];if(null==firstCol)throw new Error("no columns available");let lastValidValue=singleRow[firstCol];for(let i=0;i<columns.length;i++){const col=columns[i];if(null!=col){const sr=singleRow[col];null!=sr&&(lastValidValue=sr)}}if(null==lastValidValue)throw new Error("no valid values");return lastValidValue}(d,columns);case verbs.Kp.Concat:return function concatStrategy(singleRow,columns,delimiter){return arrayStrategy(singleRow,columns).join(delimiter)}(d,columns,delimiter);case verbs.Kp.CreateArray:return arrayStrategy(d,columns);case verbs.Kp.FirstOneWins:return firstOneWinsStrategy(d,columns)}}));return preserveSource?tempTable.derive({[to]:func}):tempTable.derive({[to]:func}).select((0,src.ff)(columns))})),print=stepVerbFactory(((input,{message,limit})=>(console.log(message),input.print(limit),input))),onehot=stepVerbFactory(((input,{column,prefix,preserveSource=!1})=>{const args=input.rollup({distinct:src.op.array_agg_distinct(column)}).get("distinct",0).sort().reduce(((acc,cur)=>(acc[prefix?`${prefix}${cur}`:`${cur}`]=(0,src.YU)((d=>null===d[column]?null:d[column]===cur?1:0)),acc)),{}),onehotted=input.derive(args,{after:input.columnNames()[input.numCols()-1]});return preserveSource?onehotted:onehotted.select((0,src.ff)(column))}));var SortDirection=__webpack_require__("../schema/src/enums/SortDirection.ts");function orderColumn({column,direction}){return direction===SortDirection.S.Descending?(0,src.C8)(column):column}const orderby=stepVerbFactory(((input,{orders})=>input.orderby(...orders.map(orderColumn)))),pivot=stepVerbFactory(((input,{key,value,operation})=>input.pivot(key,{[value]:singleExpression(value,operation)}))),recode=stepVerbFactory(((input,{column,to,mapping,dataType})=>{const finalMap={};if(dataType===data.g.Date)for(const key in mapping){const dateConversion=new Date(key),valueConversion=new Date(mapping[key]);finalMap[dateConversion.toString()]=valueConversion}return input.derive({[to]:(0,src.YU)((d=>src.op.recode(d[column],dataType===data.g.Date?finalMap:mapping)))})})),rename=stepVerbFactory(((input,{columns})=>input.rename(columns))),rollup=stepVerbFactory(((input,{column,operation,to})=>input.rollup({[to]:singleExpression(column,operation)}))),sample=stepVerbFactory(((input,{size,proportion,seed:seedArg,emitRemainder},{emit})=>{try{return null!=seedArg&&(0,src.DT)(seedArg),(()=>{const p=Math.round(input.numRows()*(proportion||1)),s=size||p;if(!emitRemainder)return input.sample(s);const inputWithIndex=input.derive({__temp_index:src.op.row_number()}),sampled=inputWithIndex.sample(s),sampledIndices=new Set,numRows=inputWithIndex.numRows(),indexColumn=sampled.getter("__temp_index");for(let i=0;i<numRows;i++){const value=indexColumn(i);null!=value&&sampledIndices.add(value)}const unsampledRows=[],inputRows=inputWithIndex.objects();for(const{__temp_index,...row}of inputRows)sampledIndices.has(__temp_index)||unsampledRows.push(row);const unsampled=(0,src.Dp)(unsampledRows);return emit(unsampled,types.u.Remainder),sampled.select(sampled.columnNames((name=>"__temp_index"!==name)))})()}finally{null!=seedArg&&(0,src.DT)(null)}}),[],[types.u.Remainder]),select_select=stepVerbFactory(((input,{columns=[]})=>{const expr=[columns];return 0===expr.length&&expr.push((0,src.$6)()),input.select(...expr)}));const spread=stepVerbFactory(((input,{to,column,delimiter,onehot,preserveSource=!1})=>{const split=function applySplit(table,column,delimiter){if(delimiter){const dArgs={[column]:(0,src.YU)((d=>src.op.split(d[column],delimiter,void 0)))};return table.derive(dArgs)}return table}(input,column,delimiter),spread=onehot?function applyOnehotSpread(table,column){const hash=function createUniqueColumnValuesHash(table,column){const unrolled=table.unroll(column),args={[column]:src.op.object_agg(column,column)},collapsed=unrolled.rollup(args);return collapsed.object(0)}(table,column),values=hash[column]??{},args=Object.keys(values).sort().reduce(((acc,value)=>(acc[`${column}_${value}`]=(0,src.YU)((d=>src.op.includes(d[column],value,void 0)?1:0)),acc)),{});return table.derive(args)}(split,column):function applyDefaultSpread(table,column,to){return table.spread(column,{as:to,drop:!1})}(split,column,to);return preserveSource?spread:spread.select((0,src.ff)(column))}));function destructureSingleValue(row,object,keys){return src.op.entries(object).forEach((function(entry){const[key,value]=entry;(void 0===keys||0===keys.length||void 0!==keys&&keys.includes(key))&&(row[key]=value)})),row}const destructure=stepVerbFactory(((input,{column,keys,preserveSource=!1})=>{const tableArray=input.objects();for(let i=0;i<tableArray.length;i++)void 0!==tableArray[i]&&void 0!==tableArray[i][column]&&(tableArray[i]=destructureSingleValue(tableArray[i],tableArray[i][column],keys));let finalTable=(0,src.Dp)(tableArray);return preserveSource?finalTable:finalTable.select((0,src.ff)(column))})),strings={replace:stepVerbFactory(((input,{column,pattern,replacement,globalSearch,caseInsensitive,to})=>{const regex=new RegExp(pattern,`${globalSearch?"g":""}${caseInsensitive?"i":""}`),fn=(0,src.YU)((d=>src.op.replace(d[column],regex,replacement)));return input.derive({[to]:fn})})),lower:stepVerbFactory(((input,{column,to})=>{const fn=(0,src.YU)((d=>src.op.lower(d[column])));return input.derive({[to]:fn})})),upper:stepVerbFactory(((input,{column,to})=>{const fn=(0,src.YU)((d=>src.op.upper(d[column])));return input.derive({[to]:fn})}))},unfold=stepVerbFactory(((input,{key,value})=>{const columnNames=input.columnNames((name=>name!==key&&name!==value)),selectedArray=input.select(columnNames).objects(),distinctColumnValues=[...new Set(input.array(key))],originalArray=input.objects(),finalArray=[],upperValue=0!==selectedArray.length?selectedArray.length/distinctColumnValues.length:distinctColumnValues.length;for(let i=0;i<upperValue;i++){let tempObj={};0!==selectedArray.length&&(tempObj={...selectedArray[i*distinctColumnValues.length]});let j=i*distinctColumnValues.length;distinctColumnValues.forEach((e=>{const obj=originalArray[j];tempObj[e]=void 0!==obj?obj[value]:null,j++})),finalArray.push(tempObj)}return(0,src.Dp)(finalArray)})),ungroup=stepVerbFactory((input=>input.ungroup())),unhot=stepVerbFactory(((input,{columns=[],to,prefix="",preserveSource=!1})=>{const merged=unhotOperation(input,columns,prefix).derive({[to]:(0,src.YU)((d=>firstOneWinsStrategy(d,columns)))});return preserveSource?merged:merged.select((0,src.ff)(columns))})),union=setOperationNodeFactory(verbs.ig.Union),unorder=stepVerbFactory((input=>input.unorder())),unroll=stepVerbFactory(((input,{column})=>input.unroll(column))),window_window=stepVerbFactory(((input,{column,operation,to})=>input.derive({[to]:singleExpression(column,operation)})));function workflow_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class WorkflowNode extends BaseNode{doRecalculate(){}constructor(id){super(),workflow_define_property(this,"_workflow",null),workflow_define_property(this,"_outputSub",null),this.id=id,this.config$.subscribe((config=>{null!=this._outputSub&&this._outputSub.unsubscribe(),null!=this._workflow&&this._workflow.dispose(),null!=config?(this._workflow=new Workflow(config?.workflow),this._workflow.input$=this.inputValue$(),this._outputSub=this._workflow.output$.subscribe((output=>{this.emit(output)}))):this._workflow=null}))}}function workflow(id){return new WorkflowNode(id)}var get=__webpack_require__("../../.yarn/cache/lodash-es-npm-4.17.21-b45832dfce-03f39878ea.zip/node_modules/lodash-es/get.js");var readStep=__webpack_require__("../../.yarn/__virtual__/@datashaper-workflow-virtual-9a99b417c8/1/javascript/workflow/src/resources/Workflow/readStep.ts");function hasDefinedInputs(step){return Object.keys(step.input).length>0}function unique(arr){return[...new Set(arr).values()]}function isVariadicSocketName(input,binding){return"others"===input||Array.isArray(binding)}function GraphManager_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class GraphManager extends Disposable.J{get defaultInput(){return this._defaultInputNode}get steps(){return this._steps$.value}get steps$(){return this._steps$}get length(){return this._steps$.value.length}get length$(){return this._numSteps$}printStats(){this._graph.printStats()}setSteps(steps){this._graph.clear(),this._graph.add(this._defaultInputNode);for(const[key,value]of this._inputDelegates)this._graph.add(observableNode(key,value));for(const step of steps)this.addStep(step)}dispose(){this._graph.clear(),this._steps$.complete(),super.dispose()}addStep(input){const steps=this.steps,prevStep=steps.length>0?steps[steps.length-1]:void 0,step=(0,readStep.A)(input,steps.length>0?prevStep:void 0);return this._graph.add(function createNode(step){const factories=verbs_namespaceObject,factory=(0,get.Z)(factories,step.verb);if(!factory)throw new Error(`unknown verb ${step.verb}`);const node=factory(step.id);return node.config=step.args,node}(step)),this.configureStep(step,prevStep),this._steps$.next([...steps,step]),step}removeStep(index){const steps=this.steps,step=steps[index];if(null==step)throw new Error(`step@${index} is invalid`);const prevStep=index>0?steps[index-1]:void 0,nextStep=index+1<this.length?steps[index+1]:void 0,node=this.getNode(step.id);if(!hasDefinedInputs(step)&&function hasPossibleInputs(node){return node.inputs.length>0}(node)&&prevStep&&nextStep){const prevNode=this.getNode(prevStep.id);this.getNode(nextStep.id).bind({node:prevNode})}return this.removeNode(step.id),this._steps$.next([...steps.slice(0,index),...steps.slice(index+1)]),node}updateStep(stepInput,index){const steps=this.steps,prevVersion=steps[index];if(null==prevVersion)throw new Error(`invalid step@${index}`);const step=(0,readStep.A)(stepInput,steps[index-1]),node=this.getNode(step.id);if(this._steps$.next([...steps.slice(0,index),step,...steps.slice(index+1)]),prevVersion.id!==step.id)throw new Error("node rename not supported yet");for(const binding of node.bindings)node.unbind(binding.input);return this.configureStep(step,index>0&&steps[index-1]||void 0),step}getOrCreateNode(id){const g=this._graph;return g.hasNode(id)?g.node(id):this.createNode(id,(0,from.D)([]))}get lastOutput$(){const steps=this.steps;if(0===steps.length)return;const lastStep=steps[steps.length-1];if(null==lastStep)return;const lastStepId=lastStep.id;return this.getNode(lastStepId).output$()}bind(id,value){const input=this._inputDelegates.get(id);if(null==input)throw new Error(`input ${id} not observed`);input.input=value}ensureInputNode(id){if(this._inputDelegates.has(id))return;if(this._graph.hasNode(id))throw new Error(`node ${id} already exists without an input seam`);const stream=new DelegateSubject;this._inputDelegates.set(id,stream);const node=observableNode(id,stream);this._graph.add(node)}removeInput(id){this._inputDelegates.delete(id),this._graph.remove(id),this.configureAllSteps()}createNode(id,value){const node=observableNode(id,value);return this._graph.add(node),node}removeNode(id){this._graph.remove(id)}configureAllSteps(){let prevStep;for(const step of this.steps)this.configureStep(step,prevStep),prevStep=step}configureStep(step,prevStep){const node=this.getNode(step.id);node.config=step.args;const stepInput="string"==typeof step.input?{source:step.input}:step.input,getNodeId=binding=>"string"==typeof binding?binding:binding.node,getOutput=binding=>"string"==typeof binding?void 0:binding.output;if(null==prevStep?node.bind({node:this.defaultInput}):null!=prevStep&&node.bind({node:this.getNode(prevStep.id)}),hasDefinedInputs(step))for(const[input,binding]of Object.entries(stepInput))if(null!=binding)if(isVariadicSocketName(input,binding))node.bind(binding.map((b=>{const nodeId=getNodeId(b),output=getOutput(b);return{node:this.getNode(nodeId),output}})));else{const nodeId=getNodeId(binding),output=getOutput(binding);this.hasNode(nodeId)?node.bind({input,node:this.getNode(nodeId),output}):console.warn(`node ${nodeId} not found`)}}getNode(id){return this._graph.node(id)}hasNode(id){return this._graph.hasNode(id)}constructor(defaultInput$){super(),GraphManager_define_property(this,"_graph",new DefaultGraph),GraphManager_define_property(this,"_defaultInputNode",void 0),GraphManager_define_property(this,"_steps$",new BehaviorSubject.X([])),GraphManager_define_property(this,"_numSteps$",this._steps$.pipe((0,map.U)((steps=>steps.length)))),GraphManager_define_property(this,"_inputDelegates",new Map),this._defaultInputNode=observableNode("__DEFAULT_INPUT__",defaultInput$),this._graph.add(this._defaultInputNode)}}var mergeWith=__webpack_require__("../../.yarn/cache/rxjs-npm-7.8.1-41c443a75b-b10cac1a52.zip/node_modules/rxjs/dist/esm5/internal/operators/mergeWith.js");function NameManager_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class NameManager{get all$(){return this._allTableNames$}get inputs$(){return this._inputNames$}get inputs(){return this._inputNames$.value}get outputs$(){return this._outputNames$}get outputs(){return this._outputNames$.value}hasInput(name){return this.inputs.some((i=>i===name))}hasOutput(name){return this.outputs.some((o=>o===name))}setNames(inputs){this._inputNames$.next(inputs)}addInput(name){return!this.hasInput(name)&&(this._inputNames$.next([...this.inputs,name]),!0)}addOutput(name){return!this.hasOutput(name)&&(this._outputNames$.next([...this.outputs,name]),!0)}removeInput(name){return!!this.hasInput(name)&&(this._inputNames$.next(this.inputs.filter((i=>i!==name))),!0)}removeOutput(name){return!!this.hasOutput(name)&&(this._outputNames$.next(this.outputs.filter((o=>o!==name))),!0)}suggestOutputName(name){const originalName=name.replace(/( \(\d+\))/,"");let derivedName=originalName,count=1;for(;this.hasOutput(derivedName);)derivedName=`${originalName} (${count})`,count++;return derivedName}assertInput(id,strict){if(void 0!==id&&!this.hasInput(id)){if(strict)throw new Error(`input name ${id} not declared`);this.addInput(id)}}dispose(){this._inputNames$.complete(),this._outputNames$.complete()}constructor(){NameManager_define_property(this,"_inputNames$",new BehaviorSubject.X([])),NameManager_define_property(this,"_outputNames$",new BehaviorSubject.X([])),NameManager_define_property(this,"_allTableNames$",this._outputNames$.pipe((0,mergeWith.b)(this._inputNames$)).pipe((0,map.U)((()=>unique(this._outputNames$.value.concat(this._inputNames$.value))))))}}var ajv=__webpack_require__("../../.yarn/cache/ajv-npm-8.12.0-3bf6e30741-b406f3b79b.zip/node_modules/ajv/dist/ajv.js"),ajv_default=__webpack_require__.n(ajv),ajv_formats_dist=__webpack_require__("../../.yarn/__virtual__/ajv-formats-virtual-967e01a5f8/0/cache/ajv-formats-npm-2.1.1-3cec02eae9-70c263ded2.zip/node_modules/ajv-formats/dist/index.js"),dist_default=__webpack_require__.n(ajv_formats_dist);const network_log=browser_default()("datashaper:network");class WorkflowSchemaValidator{static async validate(workflowJson){const validator=WorkflowSchemaValidator.validator,{$schema}=workflowJson||{};if(null==$schema)return console.warn("No $schema property found in workflow JSON"),!0;if(!validator.schemas[$schema]){const schemaJson=await async function fetchJson(url){network_log("fetching json",url);try{const response=await fetch(url);return network_log(`fetched json [${response.status}]`,url),response.json()}catch(e){throw network_log("error fetching json",url,e),e}}($schema);validator.addSchema(schemaJson,$schema)}return!!validator.getSchema($schema)?.(workflowJson)}}!function WorkflowSchemaValidator_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}(WorkflowSchemaValidator,"validator",function createSchemaValidator(){const result=new(ajv_default())({strict:!0,strictSchema:!0,strictTypes:!0,strictRequired:!0,validateSchema:!0,allowUnionTypes:!0});return dist_default()(result),result}());var predicates=__webpack_require__("../../.yarn/__virtual__/@datashaper-workflow-virtual-9a99b417c8/1/javascript/workflow/src/predicates.ts");function Workflow_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const Workflow_log=browser_default()("datashaper:workflow");class Workflow extends Resource._{defaultTitle(){return"workflow"}defaultName(){return"workflow.json"}connect(dp,top){if(Workflow_log("connecting"),super.connect(dp,top),dp!==this.dataPackage||null==this._dataPackageSub){this.dataPackage=dp,this._dataPackageSub?.();const inputs=new Map,rebindInputs=()=>{inputs.clear();const values=dp.resources.filter(predicates.NT).map((r=>r.name)).reduce(((prev,name)=>{const emitter=dp.getResource(name);return prev.set(name,emitter?.output$??empty.E),prev}),new Map);Workflow_log("bind workflow inputs",values),this.addInputs(values)};this._dataPackageSub=dp.onChange(rebindInputs),rebindInputs()}}read(name){const table=this._read(name).value;return this.renameTo(name)(table)}read$(name){return this._read(name).pipe((0,map.U)(this.renameTo(name)))}_read(name){if(null==name)return this._tableMgr.defaultOutput$;const[result,created]=this._tableMgr.ensure(name);return created&&this.observeOutput(name),result}get tableNames$(){return this._nameMgr.all$}get tableNames(){return unique(this.inputNames.concat(this.outputNames))}get inputNames(){return this._nameMgr.inputs}get inputNames$(){return this._nameMgr.inputs$}addInputName(input){this._nameMgr.addInput(input)||(this._graphMgr.ensureInputNode(input),this._onChange.next())}removeInputName(name){this._nameMgr.removeInput(name)||(this._graphMgr.removeInput(name),this._tableMgr.remove(name,RemoveMode.Hard),this._onChange.next())}hasInputName(input){return this._nameMgr.hasInput(input)}get input$(){return this._tableMgr.defaultInput$}set input$(source){this._tableMgr.defaultInput$=source??empty.E,this._graphMgr.configureAllSteps(),this._onChange.next()}get input(){return this._tableMgr.defaultInput$.value}set input(source){this._tableMgr.defaultInput=source,this._graphMgr.configureAllSteps(),this._onChange.next()}addInput(source,id){this._assertInputName(id),this._graphMgr.ensureInputNode(id),this._bindInputObservable(id,source),this._graphMgr.configureAllSteps(),this._onChange.next()}addInputs(values){for(const id of values.keys())this._assertInputName(id);for(const[id,source]of values.entries())this._graphMgr.ensureInputNode(id),this._bindInputObservable(id,source);this._graphMgr.configureAllSteps(),this._onChange.next()}removeInputObservable(id){this._removeInputObservableSilent(id),this._onChange.next()}_removeInputObservableSilent(id){this._graphMgr.removeNode(id),this._tableMgr.remove(id,RemoveMode.Soft)}addInputTable(table,id){this.addInput((0,of.of)(table),id)}addInputTables(inputs){const map=new Map;for(const i of inputs)map.set(i.id,(0,of.of)(i));this.addInputs(map)}_bindInputObservable(id,source){const d$=this._tableMgr.bind(id,source);this._graphMgr.bind(id,d$)}_assertInputName(id){this._nameMgr.assertInput(id,this._strictInputs)}get output$(){return this.read$()}get output(){return this.read()}hasOutputName(name){return this._nameMgr.hasOutput(name)}suggestOutputName(name){return this._nameMgr.suggestOutputName(name)}get outputNames(){return this._nameMgr.outputs}get outputNames$(){return this._nameMgr.outputs$}addOutput(name){if(this.hasOutputName(name)||this.hasInputName(name))throw new Error("new output name must be unique among outputs & inputs");this._nameMgr.addOutput(name),this.observeOutput(name),this._onChange.next()}removeOutput(name){this._nameMgr.removeOutput(name)&&(this._tableMgr.remove(name,RemoveMode.Hard),this._onChange.next())}get steps(){return this._graphMgr.steps}get steps$(){return this._graphMgr.steps$}get length(){return this._graphMgr.length}get length$(){return this._graphMgr.length$}addStep(input){Workflow_log("add step",input);const newStep=this._graphMgr.addStep(input);return this.rebindDefaultOutput(),this._onChange.next(),newStep}removeStep(index){Workflow_log(`remove step@${index}`);const node=this._graphMgr.removeStep(index),stepOutputs=this.outputNames.filter((o=>o===node.id));for(const o of stepOutputs)this.removeOutput(o);this.rebindDefaultOutput(),this._onChange.next()}updateStep(stepInput,index){Workflow_log(`update step@${index}`);const step=this._graphMgr.updateStep(stepInput,index);return this._onChange.next(),step}toSchema(){return(0,factories.gW)({...super.toSchema(),input:[...this.inputNames],steps:[...this.steps]})}loadSchema(schema,quiet){super.loadSchema(schema,!0);const input=unique(schema?.input??[]);this._nameMgr.setNames(input);for(const i of input)this._graphMgr.ensureInputNode(i);this._graphMgr.setSteps(schema?.steps?.map((i=>i))??[]),this.rebindDefaultOutput(),quiet||this._onChange.next()}static async validate(workflowJson){return WorkflowSchemaValidator.validate(workflowJson)}dispose(){Workflow_log("disposing"),this._dataPackageSub?.(),this._graphMgr.dispose(),this._tableMgr.dispose(),this._nameMgr.dispose(),super.dispose()}printStats(){this._graphMgr.printStats()}toArray({includeDefaultInput,includeDefaultOutput,includeInputs}={}){return this._tableMgr.toArray(includeInputs?[...this.inputNames,...this.outputNames]:this.outputNames,includeDefaultInput,includeDefaultOutput)}rebindDefaultOutput(){const data$=this._graphMgr.lastOutput$??this._tableMgr.defaultInput$;this._tableMgr.defaultOutput$=data$}observeOutput(nodeId,socketName){const[outputTable]=this._tableMgr.ensure(nodeId),n=this._graphMgr.getOrCreateNode(nodeId);outputTable.input=n.output$(socketName)}constructor(input,_strictInputs=!1){super(),Workflow_define_property(this,"_strictInputs",void 0),Workflow_define_property(this,"$schema",void 0),Workflow_define_property(this,"profile",void 0),Workflow_define_property(this,"_nameMgr",void 0),Workflow_define_property(this,"_tableMgr",void 0),Workflow_define_property(this,"_graphMgr",void 0),Workflow_define_property(this,"_dataPackageSub",void 0),Workflow_define_property(this,"renameTo",void 0),this._strictInputs=_strictInputs,this.$schema=factories.r1,this.profile=Profile.w.Workflow,this._nameMgr=new NameManager,this._tableMgr=new TableManager,this._graphMgr=new GraphManager(this._tableMgr.defaultInput$),this.renameTo=name=>table=>({...table??{},id:name??this.name}),this.loadSchema(input,!0),this.rebindDefaultOutput()}}},"../../.yarn/__virtual__/@datashaper-workflow-virtual-9a99b417c8/1/javascript/workflow/src/resources/Workflow/readStep.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>readStep});var defaults_namespaceObject={};__webpack_require__.r(defaults_namespaceObject),__webpack_require__.d(defaults_namespaceObject,{aggregate:()=>aggregate,bin:()=>bin,binarize:()=>binarize,boolean:()=>boolean_boolean,concat:()=>concat,convert:()=>convert,copy:()=>copy,decode:()=>decode,dedupe:()=>dedupe,derive:()=>derive,destructure:()=>destructure,difference:()=>difference,drop:()=>drop,encode:()=>encode,erase:()=>erase,fill:()=>fill,filter:()=>filter,fold:()=>fold,groupby:()=>groupby,impute:()=>impute,intersect:()=>intersect,join:()=>join,lookup:()=>lookup,merge:()=>merge,onehot:()=>onehot,orderby:()=>orderby,pivot:()=>pivot,print:()=>print,recode:()=>recode,rename:()=>rename,rollup:()=>rollup,sample:()=>sample,select:()=>defaults_select,spread:()=>spread,strings:()=>strings,unfold:()=>unfold,ungroup:()=>ungroup,unhot:()=>unhot,union:()=>union,unorder:()=>unorder,unroll:()=>unroll,window:()=>defaults_window,workflow:()=>workflow});const inputColumnList=()=>({columns:[]}),outputColumn=()=>({to:"output"});var verbs=__webpack_require__("../schema/src/workflow/verbs.ts");const bin=()=>({strategy:verbs.Lo.Auto,fixedcount:10,to:"output"}),filter=()=>({criteria:[],logical:verbs._W.OR}),binarize=()=>({to:"output",...filter()}),boolean_boolean=()=>({operator:verbs._W.OR,columns:[],to:"output"}),convert=()=>({type:verbs.rJ.Decimal,formatPattern:"%Y-%m-%d",to:"output"}),copy=()=>({to:"output"}),destructure=()=>({keys:[]}),fold=()=>({to:["key","value"],columns:[]}),join=()=>({on:[],strategy:verbs.Fo.Inner}),lookup=()=>({on:[],columns:[]}),merge=()=>({strategy:verbs.Kp.FirstOneWins,columns:[],to:"output"}),pivot=()=>({operation:verbs.Ei.Any}),print=()=>({limit:10}),spread=()=>({to:[]}),unfold=()=>({}),unhot=()=>({prefix:"",preserveSource:!1,columns:[],to:"output"}),empty=()=>({}),aggregate=outputColumn,dedupe=inputColumnList,derive=outputColumn,drop=inputColumnList,erase=inputColumnList,fill=outputColumn,groupby=inputColumnList,impute=inputColumnList,rollup=outputColumn,defaults_select=inputColumnList,unroll=inputColumnList,defaults_window=outputColumn,strings={replace:outputColumn,lower:outputColumn,upper:outputColumn},decode=empty,encode=empty,concat=empty,difference=empty,intersect=empty,onehot=empty,orderby=empty,recode=empty,rename=empty,sample=empty,ungroup=empty,union=empty,unorder=empty,workflow=empty;var get=__webpack_require__("../../.yarn/cache/lodash-es-npm-4.17.21-b45832dfce-03f39878ea.zip/node_modules/lodash-es/get.js");const uid=(()=>{const map=new Map;return verb=>{const next=(map.get(verb)||0)+1;return map.set(verb,next),`${verb} (${next})`}})();function readStep({verb,args={},id,input},previous){const base={id:id||uid(verb),args,verb,input:resolveInputs(input,previous)},factories=defaults_namespaceObject,factory=(0,get.Z)(factories,verb);if(!factory)throw new Error(`missing verb defaults [${verb}]`);return{...base,args:{...factory(),...args}}}function resolveInputs(input,previous){if(null==input)return null==previous?{}:{source:{node:previous.id}};if("string"==typeof input)return{source:{node:input}};const result={};for(const[key,value]of Object.entries(input))result[key]="string"==typeof value?{node:value}:value;return result}},"../schema/src/enums/SortDirection.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{var SortDirection;__webpack_require__.d(__webpack_exports__,{S:()=>SortDirection}),function(SortDirection){SortDirection.Ascending="asc",SortDirection.Descending="desc"}(SortDirection||(SortDirection={}))}}]);